<div ng-controller="patientsCtrl">


    <div class="form-group">
        <label for="patient">Patient</label>
         <span class="nullable">
            <select class="form-control dropdown-menu-right" id="patient" ng-model="selectedPatient">
                <option value="" selected="selected"></option>
                <option value="{{patient.id}}" ng-repeat="patient in patients">{{patient.name}}</option>
            </select>
         </span>
    </div>

    <div ng-show="selectedPatient">
        <ul class="nav nav-tabs" role="tablist">
            <li ng-repeat="(i, questionnaire) in questionnaires track by $index"
                ng-click="selectQuestionnaire(i)"
                ng-class="(selectedQuestionnaire.index == questionnaire.id -1) ? 'active': ''">
                <a><label>{{questionnaire.title}}</label></a>
            </li>
        </ul>
        <br>

        <div ng-show="selectedPatient">

            <div class="table-responsive">
                <table class="table table-bordered table-striped">
                    <thead>
                    <tr>
                        <th></th>
                        <th ng-repeat="reply in replies[selectedQuestionnaire.index]">
                            {{reply.date}}
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="score in questionnaires[selectedQuestionnaire.index].scores">
                        <th>{{score.name}}</th>
                        <td class="score" ng-repeat="(i, reply) in replies[selectedQuestionnaire.index] track by $index">
                            <button type="button" class="btn btn-link btn-gray" ng-click="chooseReply(i)">
                                {{reply[score.type]}}
                            </button>
                        </td>
                    </tr>

                    </tbody>
                </table>
            </div>

            <div class="row" ng-show="showReply">
                <div class="container">
                    <div class="jumbotron">
                        <div class="row">
                            <button aria-hidden="true" class="close" ng-click="closeReply()"
                                    ng-if="!first_choice">&times;</button>
                        </div>
                        <br>
                        <div class="row">
                            <questionnaire-form questionnaire="questionnaires[selectedQuestionnaire.index]"
                                                index="selectedQuestionnaire.index"
                                                answers="replies[selectedQuestionnaire.index][selectedReply].data"
                                                reply="false"></questionnaire-form>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="span12">
                    <h2>In action</h2>
                </div>
            </div>

            <div class="btn-group">
                <button type="button" class="btn btn-default"
                        ng-repeat="(i, questionnaire) in questionnaires track by $index"
                        ng-click="selectQuesionnaire(i); selectedQuestionnaire.index = i; updateData(replies[selectedQuestionnaire.index])"
                        ng-class="(selectedQuestionnaire.index == questionnaire.id -1) ? 'selected': ''">
                    {{questionnaire.title}}
                </button>
            </div>


            <div class="row">
                <div class="span6">
                    <chart value="myChart" id="myCoolChart"></chart>
                    <p>^ This is a chart</p>


                    <button ng-click="updateData(replies[selectedQuestionnaire.index])">
                        Update Data
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>